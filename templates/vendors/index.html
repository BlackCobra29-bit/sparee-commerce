{% extends "vendors/base.html" %}
{% load static %}
{% block vendor_content %}
  
      <!-- KPI Cards (Vendor Focused) -->
      <div class="row">
  
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">Total Products</p>
                    <h5 class="font-weight-bolder mb-0">
                      {{ total_stock_quantity }}
                    </h5>
                    <p class="text-xs text-secondary mb-0 mt-1">Product types: <b>{{ product_types_count }}</b></p>
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                    <i class="ni ni-money-coins text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
  
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">Pending Orders</p>
                    <h5 class="font-weight-bolder mb-0">
                      {{ pending_orders_count }}
                    </h5>
                    <p class="text-xs text-secondary mb-0 mt-1">Not delivered orders</p>
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape bg-gradient-warning shadow text-center border-radius-md">
                    <i class="ni ni-cart text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
  
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">Low Stock Items</p>
                    <h5 class="font-weight-bolder mb-0">
                      {{ low_stock_count }}
                      <span class="text-danger text-sm font-weight-bolder">{% if low_stock_count %}Urgent{% else %}Stable{% endif %}</span>
                    </h5>
                    <p class="text-xs text-secondary mb-0 mt-1">Below reorder level</p>
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape bg-gradient-danger shadow text-center border-radius-md">
                    <i class="ni ni-box-2 text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
  
        <div class="col-xl-3 col-sm-6">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">Total Items Sold</p>
                    <h5 class="font-weight-bolder mb-0">
                      {{ delivered_orders_quantity }}
                      <span class="text-info text-sm font-weight-bolder">Items</span>
                    </h5>
                    <p class="text-xs text-secondary mb-0 mt-1">Period: <b>All time</b></p>
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape bg-gradient-info shadow text-center border-radius-md">
                    <i class="ni ni-credit-card text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
  
      </div>

      <div class="row mt-4">
        <div class="col-lg-7 mb-4">
          <div class="card h-100">
            <div class="card-header pb-0">
              <h6 class="mb-1">Products Quantity Added Monthly</h6>
              <p class="text-sm mb-0 text-secondary">Last 6 months (not ordered + ordered)</p>
            </div>
            <div class="card-body">
              <div id="products-added-monthly-chart" style="height: 320px; width: 100%;"></div>
            </div>
          </div>
        </div>
        <div class="col-lg-5 mb-4">
          <div class="card h-100">
            <div class="card-header pb-0">
              <h6 class="mb-1">Products Delivered Monthly</h6>
              <p class="text-sm mb-0 text-secondary">Delivered quantities (last 6 months)</p>
            </div>
            <div class="card-body">
              <div id="products-delivered-monthly-chart" style="height: 320px; width: 100%;"></div>
            </div>
          </div>
        </div>
      </div>
      
{% endblock %}

{% block vendor_extra_js %}
{{ monthly_added_chart_data|json_script:"monthly-added-chart-data" }}
{{ monthly_delivered_chart_data|json_script:"monthly-delivered-chart-data" }}
<script src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    if (typeof CanvasJS === "undefined") return;

    var addedData = JSON.parse(
      document.getElementById("monthly-added-chart-data")?.textContent || "[]"
    );
    var deliveredData = JSON.parse(
      document.getElementById("monthly-delivered-chart-data")?.textContent || "[]"
    );

    var addedChart = new CanvasJS.Chart("products-added-monthly-chart", {
      animationEnabled: true,
      backgroundColor: "transparent",
      axisY: {
        title: "Quantity Added",
        includeZero: true,
        gridThickness: 0,
      },
      toolTip: {
        shared: true,
      },
      data: [
        {
          type: "column",
          color: "#5e72e4",
          yValueFormatString: "#,##0",
          dataPoints: addedData,
        },
      ],
    });

    var deliveredChart = new CanvasJS.Chart("products-delivered-monthly-chart", {
      animationEnabled: true,
      backgroundColor: "transparent",
      axisX: {
        lineColor: "#6c757d",
        tickColor: "#6c757d",
        labelFontColor: "#1f2937",
      },
      axisY: {
        title: "Delivered Quantity",
        includeZero: true,
        gridThickness: 0,
        lineColor: "#6c757d",
        tickColor: "#6c757d",
        labelFontColor: "#1f2937",
      },
      toolTip: {
        shared: true,
      },
      data: [
        {
          type: "line",
          color: "#4f81bd",
          lineThickness: 3,
          markerType: "circle",
          markerSize: 7,
          markerColor: "#4f81bd",
          yValueFormatString: "#,##0",
          dataPoints: deliveredData,
        },
      ],
    });

    addedChart.render();
    deliveredChart.render();
  });
</script>
{% endblock %}
