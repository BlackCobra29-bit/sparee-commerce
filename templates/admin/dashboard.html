{% extends "vendors/base.html" %}
{% load number_format %}

{% block vendor_title %}Admin Dashboard - Wahid Spare Hub{% endblock %}

{% block vendor_content %}
<div class="row">
  <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-capitalize font-weight-bold">Verified Sellers</p>
              <h5 class="font-weight-bolder mb-0">
                {{ total_sellers_count|number_separator }}
              </h5>
            </div>
          </div>
          <div class="col-4 text-end">
            <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
              <i class="ni ni-single-02 text-lg opacity-10" aria-hidden="true"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-capitalize font-weight-bold">Pending Approvals</p>
              <h5 class="font-weight-bolder mb-0">
                {{ pending_approvals_count|number_separator }}
                <span class="text-warning text-sm font-weight-bolder">Needs action</span>
              </h5>
            </div>
          </div>
          <div class="col-4 text-end">
            <div class="icon icon-shape bg-gradient-warning shadow text-center border-radius-md">
              <i class="ni ni-time-alarm text-lg opacity-10" aria-hidden="true"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-capitalize font-weight-bold">Products Sold</p>
              <h5 class="font-weight-bolder mb-0">
                {{ products_sold_count|number_separator }}
              </h5>
            </div>
          </div>
          <div class="col-4 text-end">
            <div class="icon icon-shape bg-gradient-danger shadow text-center border-radius-md">
              <i class="ni ni-tag text-lg opacity-10" aria-hidden="true"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-sm-6">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-capitalize font-weight-bold">Active Products</p>
              <h5 class="font-weight-bolder mb-0">
                {{ active_products_count|number_separator }}
              </h5>
            </div>
          </div>
          <div class="col-4 text-end">
            <div class="icon icon-shape bg-gradient-info shadow text-center border-radius-md">
              <i class="ni ni-chat-round text-lg opacity-10" aria-hidden="true"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-lg-6 mb-4">
    <div class="card mb-4">
      <div class="card-header pb-0">
        <h6 class="mb-1">Product Quantities Sold (Last 6 Months)</h6>
        <p class="text-sm mb-0 text-secondary">Delivered product quantities by month.</p>
      </div>
      <div class="card-body">
        <div id="admin-quantity-chart" style="height: 340px; width: 100%;"></div>
      </div>
    </div>
  </div>
  <div class="col-lg-6 mb-4">
    <div class="card mb-4">
      <div class="card-header pb-0">
        <h6 class="mb-1">Money Transacted/Sold (Last 6 Months)</h6>
        <p class="text-sm mb-0 text-secondary">Total delivered sales amount (ETB) by month.</p>
      </div>
      <div class="card-body">
        <div id="admin-amount-chart" style="height: 340px; width: 100%;"></div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block vendor_extra_js %}
{{ admin_monthly_quantity_chart_data|json_script:"admin-monthly-quantity-chart-data" }}
{{ admin_monthly_amount_chart_data|json_script:"admin-monthly-amount-chart-data" }}
<script src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    if (typeof CanvasJS === "undefined") return;

    var quantityData = JSON.parse(
      document.getElementById("admin-monthly-quantity-chart-data")?.textContent || "[]"
    );
    var amountData = JSON.parse(
      document.getElementById("admin-monthly-amount-chart-data")?.textContent || "[]"
    );

    var quantityChart = new CanvasJS.Chart("admin-quantity-chart", {
      animationEnabled: true,
      backgroundColor: "transparent",
      axisY: {
        title: "Quantity Sold",
        includeZero: true,
        gridThickness: 0,
      },
      toolTip: {
        shared: false,
      },
      data: [
        {
          type: "column",
          name: "Quantity Sold",
          color: "#4f81bd",
          yValueFormatString: "#,##0",
          dataPoints: quantityData,
        },
      ],
    });

    var amountChart = new CanvasJS.Chart("admin-amount-chart", {
      animationEnabled: true,
      backgroundColor: "transparent",
      axisY: {
        title: "Amount Sold (ETB)",
        includeZero: true,
        prefix: "ETB ",
        gridThickness: 0,
      },
      toolTip: {
        shared: false,
      },
      data: [
        {
          type: "line",
          name: "Amount Sold",
          color: "#2dce89",
          lineThickness: 3,
          markerType: "circle",
          markerSize: 6,
          yValueFormatString: "ETB #,##0.##",
          dataPoints: amountData,
        },
      ],
    });

    quantityChart.render();
    amountChart.render();
  });
</script>
{% endblock %}
